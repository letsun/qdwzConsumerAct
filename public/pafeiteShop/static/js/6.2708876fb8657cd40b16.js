webpackJsonp([6],{"0sBh":function(t,e){},DEle:function(t,e){},Oynu:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=s("//Fk"),i=s.n(r),o=s("Xxa5"),a=s.n(o),n=s("exGp"),d=s.n(n),c=s("GQaK"),u=s("OUXH"),l=s("lN47"),h={props:{pageType:{type:String,default:"order"},price:{type:Number,default:0},totalScore:{type:Number,default:0},goodsType:{type:Number,default:0},checkCount:{type:Number,default:0}},methods:{createOrder:function(){this.$emit("clickEvent")}}},p={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"cart-infor",class:"type-"+t.pageType},[s("div",{staticClass:"left"},[t._v("合计：\n\t\t\t"),0===t.goodsType?[t._v("\n\t\t\t\t"+t._s(t._f("currency")(t.price,"￥"))),s("span",[t._v("元")])]:[t._v("\n\t\t\t\t"+t._s(t.totalScore)+" "),s("span",[t._v("积分")])]],2),t._v(" "),s("div",{staticClass:"buy",class:{checked:t.checkCount<=0},on:{click:t.createOrder}},[s("i",{staticClass:"icon iconfont icon-qian"}),t._v(" "),t._t("default")],2)])])},staticRenderFns:[]};var v=s("VU/8")(h,p,!1,function(t){s("nFiK")},"data-v-4e773cba",null).exports,f=s("wzPG"),y=s("7AG+"),m={props:{payMentedLoading:{type:Boolean,default:!1},countdownTip:{type:Number,default:5}},data:function(){return{}},mounted:function(){this.$nextTick(function(){})},methods:{}},g={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.payMentedLoading?s("div",{staticClass:"payMented-loading"},[s("div",{staticClass:"container"},[s("div",{staticClass:"countdown"},[t._v(t._s(t.countdownTip))]),t._v(" "),s("div",{staticClass:"countdown-text"},[t._v("请稍等，正在检查订单中...")])]),t._v(" "),s("div",{staticClass:"advertage"},[t._v("\n\t\t\t更多优惠等你来\n\t\t")])]):t._e()])},staticRenderFns:[]};var C=s("VU/8")(m,g,!1,function(t){s("DEle")},"data-v-239c861c",null).exports,_=s("zZaa"),k=s("d1wj"),S=(s("ywmu"),s("iFI/"),s("yt7g")),L=s("CyOZ"),w=s("zSeF"),T={components:{NavHeader:u.a,ProList:l.a,BottomControls:v,ModelWin:f.a,LoadingPage:y.a,PaymentedLoading:C,WaitingTip:_.a},data:function(){return{scroll:null,query:{},productList:[],checkedAddressInfor:{},addressCount:1,freight:0,errorTip:"",showModel:!1,isConfirm:!1,okType:"",isRouter:!1,discountMoney:0,isCashAndIntegral:!1,isCashAndCoupon:!1,payScore:0,couponMoney:0,couponId:0,isLoadCompleted:!0,payMentedLoading:!1,countdownTip:5,result:1,orderType:0,selfMentionFlag:"",imgPath:"https://qdwzvue-1254182596.cos.ap-guangzhou.myqcloud.com/qdwzAct/pafeite/",isClicked:!1,isClick:!0}},mounted:function(){var t=this;this.$nextTick(d()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return $("body").show(),Object(L.a)(t,t.getHeaders,"-1"),t.$route.query.goodsId&&(t.query.goodsId=t.$route.query.goodsId),t.$route.query.chooseJsonProp&&(t.query.chooseJsonProp=t.$route.query.chooseJsonProp),t.$route.query.amount&&(t.query.amount=t.$route.query.amount),t.$route.query.addressType&&(t.query.addressType=t.$route.query.addressType),t.$route.query.id&&(t.query.id=t.$route.query.id),e.next=9,t.initAddress();case 9:return e.next=11,t.initProductList();case 11:t.initScroll();case 12:case"end":return e.stop()}},e,t)})))},computed:{getHeaders:function(){return this.$store.getters.getHeaders},mallType:function(){return this.$store.state.mallType},productAmount:function(){for(var t=0,e=0,s=this.productList.length;e<s;e++)t+=this.productList[e].amount;return t},totalScore:function(){for(var t=0,e=0,s=this.productList.length;e<s;e++)t+=this.productList[e].amount*this.productList[e].goodsScore;return t},myScore:function(){return this.$store.state.balanceScore},orderProduct:function(){for(var t=[],e=0,s=this.productList.length;e<s;e++){var r={};r.goodsId=this.productList[e].goodsId,r.amount=this.productList[e].amount,r.chooseJsonProp=this.productList[e].chooseJsonProp,r.goodsType=2,r.userName="",r.mobile="",r.idCard="",t.push(r)}return t},goodsType:function(){for(var t=0,e=0,s=this.productList.length;e<s;e++)t=this.productList[e].goodsType;return t},isContainer:function(){for(var t=0,e=0,s=this.productList.length;e<s;e++)t=this.productList[e].isopenContainer;return t},goodsInfo:function(){for(var t=[],e=0,s=this.productList.length;e<s;e++)t.push(this.productList[e].goodsId+","+this.productList[e].amount);return t.join("@")}},methods:{initScroll:function(){this.scroll=new c.a(this.$refs.scrollWrapper,{scrollbar:{fade:!0},click:!0})},initAddress:function(){var t=this;if(!this.query.id)return new i.a(function(e,s){t.$http.get(k.a.address.getDefaultAddress).then(function(s){var r=s.data;r.code===w.a.SUCCESS?t.checkedAddressInfor=r.data?r.data:{}:S.a.checkStatus(t,r,{},t.initAddress),e()})});this.$http.get(k.a.address.addressList).then(function(e){var s=e.data;if(s.code===w.a.SUCCESS&&t.query.id)for(var r=0;r<s.data.length;r++)t.query.id==s.data[r].id&&(t.checkedAddressInfor=s.data[r])})},initProductList:function(){var t=this,e="";return this.$route.query.chooseJsonProp&&(e=JSON.parse(this.$route.query.chooseJsonProp)),new i.a(function(s,r){t.$http.get(k.a.order.getGoodsListById,{params:{goodsId:t.$route.query.goodsId,amount:t.$route.query.amount,chooseJsonProp:e}}).then(function(e){var r=e.data;r.code===w.a.SUCCESS?(t.isLoadCompleted=!0,t.productList=r.data.goodsList,t.selfMentionFlag=r.data.selfMentionFlag,t.addressInfor=r.data.address,console.log(t.productList)):S.a.checkStatus(t,r,{},t.initProductList),s()})})},openPayMent:function(){if(0==this.orderType&&void 0===this.checkedAddressInfor.id)return this.isConfirm=!1,this.showModel=!0,void(this.errorTip="请选择收货地址");this.showModel=!0,this.isConfirm=!0,this.okType=this.payMentFunc,this.errorTip="您确定要兑换"+this.productList[0].goodsName+"吗？"},payMentFunc:function(){var t=this;if(this.totalScore>this.myScore)return this.showModel=!0,this.isConfirm=!1,void(this.errorTip="您的元气值不足，不能兑换该商品！");var e={freight:this.freight,goodsList:this.orderProduct,goodsTotal:this.orderProduct.length,mallType:this.mallType,orderType:this.orderType,receiveAddrId:this.checkedAddressInfor.id,orderCategory:0,payType:5,exchangeMoney:0,payScore:this.totalScore,payMoney:0,totalMoney:0,orderRemark:"",isContainer:0};this.$http.post(k.a.order.createOrder,e,{headers:this.getHeaders}).then(function(e){var s=e.data;s.code===w.a.SUCCESS?0===s.data.isPayFlag&&(console.log(t.orderProduct),t.$router.push({path:"/exchangeSuccess",query:{goodsName:t.productList[0].goodsName,goodsType:2}}),t.isClick=!0):(t.isClick=!0,t.isRouter=!1,S.a.checkStatus(t,s,{},t.payMent))})},closeModelWin:function(){this.showModel=!1,this.isConfirm=!1,this.isRouter&&this.$router.push({path:"/waitPayment"})},okModelWin:function(t){if(!this.isClick)return!1;this.isClick=!1,t()},selectAddress:function(){this.query.addressType=1,this.query.redirectUrl="/createOrder",this.$router.push({path:"/address",query:this.query})},showMinDeductionError:function(t){this.showModel=!0,this.isConfirm=!1,this.errorTip=t},deduction:function(t,e){this.discountMoney=t,this.payScore=e},payMentSuccess:function(t){var e=this;this.$http.get(k.a.order.getOrderById,{headers:this.getHeaders,params:{orderId:t}}).then(function(s){var r=s.data;r.code===w.a.SUCCESS?(e.payMentedLoading=!1,e.$router.push({path:"/paymentSuccess",query:{orderId:r.data.orderList[0].orderId,status:r.data.orderList[0].status}})):S.a.checkStatus(e,r,{},e.payMentSuccess,t)})},refresh:function(){this.scroll.refresh()},showError:function(t,e){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.showModel=!0,s?(this.isConfirm=s,this.okType=e):(this.isConfirm=!1,this.okType=""),this.errorTip=t},checkOrder:function(){var t=this;this.$http.get(k.a.product.checkOrder).then(function(e){var s=e.data;s.code===w.a.SUCCESS&&(t.result=s.data.result)})}}},M={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("nav-header",{attrs:{back:"true",color:"1"}},[s("div",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[t._v("立即兑换")])]),t._v(" "),s("div",{ref:"scrollWrapper",staticClass:"scroll-wrapper"},[s("div",{staticClass:"wrapper"},[s("div",{staticClass:"address-wrapper",on:{click:t.selectAddress}},[t.checkedAddressInfor.id?[s("div",{staticClass:"receiver-wra"},[s("div",{staticClass:"receiver-infor"},[s("div",{staticClass:"receiver-right"},[s("div",{staticClass:"receiver"},[t._v("收货人："+t._s(t.checkedAddressInfor.receiveName))]),t._v(" "),s("div",{staticClass:"tel"},[t._v(t._s(t.checkedAddressInfor.receivePhone))])])]),t._v(" "),s("div",{staticClass:"address-infor",staticStyle:{"margin-left":"54px"}},[s("div",{staticClass:"key"},[t._v("收货地址：")]),t._v(" "),s("div",{staticClass:"value"},[s("span",[t._v(t._s(t.checkedAddressInfor.receiveProvince))]),t._v(" "),s("span",[t._v(t._s(t.checkedAddressInfor.receiveCity))]),t._v(" "),s("span",[t._v(t._s(t.checkedAddressInfor.receiveArea))]),t._v(" "),s("span",[t._v(t._s(t.checkedAddressInfor.receiveAddress))])])])])]:[t._m(0)],t._v(" "),s("i",{staticClass:"icon iconfont icon-arrow-right-copy"})],2),t._v(" "),s("div",{staticClass:"order-wrapper"},[s("ul",{staticClass:"pro-list"},t._l(t.productList,function(e,r){return s("li",{key:r,staticClass:"pro-item",on:{click:function(s){s.stopPropagation(),t.toDetail(e)}}},[s("div",{staticClass:"pro-pic"},[s("img",{directives:[{name:"adaptiveSrc",rawName:"v-adaptiveSrc:li",value:e.imagesUrl,expression:"item.imagesUrl",arg:"li"}]})]),t._v(" "),s("div",{staticClass:"pro-right"},[s("div",{staticClass:"pro-title"},[t._v(t._s(e.goodsName))])])])}))]),t._v(" "),s("div",{staticClass:"list"},[t._m(1),t._v(" "),s("div",{staticClass:"item"},[s("div",{staticClass:"item-key"},[t._v("商品价格")]),t._v(" "),s("div",{staticClass:"item-val color"},[t._v(t._s(t.productList[0].goodsScore)+"积分")])])]),t._v(" "),s("div",{staticClass:"buy",on:{click:t.openPayMent}},[t._v("确认兑换")])])]),t._v(" "),s("model-win",{attrs:{show:t.showModel}},[s("template",{slot:"content"},[s("span",{domProps:{innerHTML:t._s(t.errorTip)}})]),t._v(" "),s("template",{slot:"btn"},[t.isConfirm?[s("a",{staticClass:"btn",attrs:{href:"javascript:void(0);"},on:{click:t.closeModelWin}},[t._v("取消")]),t._v(" "),s("a",{staticClass:"btn btn-last",attrs:{href:"javascript:void(0);"},on:{click:function(e){t.okModelWin(t.okType)}}},[t._v("确定")])]:[s("a",{staticClass:"btn",attrs:{href:"javascript:void(0);"},on:{click:t.closeModelWin}},[t._v("确定")])]],2)],2),t._v(" "),s("transition",{attrs:{name:"fade"}},[s("waiting-tip",{directives:[{name:"show",rawName:"v-show",value:t.isClicked,expression:"isClicked"}]})],1),t._v(" "),s("transition",{attrs:{name:"fade"}},[t.isLoadCompleted?t._e():s("loading-page")],1)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"address-infor"},[e("span",[this._v("请选择一个收货地址")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"item"},[e("div",{staticClass:"item-key"},[this._v("配送方式")]),this._v(" "),e("div",{staticClass:"item-val"},[this._v("快递包邮")])])}]};var q=s("VU/8")(T,M,!1,function(t){s("0sBh")},"data-v-7393b36f",null);e.default=q.exports},nFiK:function(t,e){}});