webpackJsonp([1],{"9bBU":function(o,e,t){t("mClu");var s=t("FeBl").Object;o.exports=function(o,e,t){return s.defineProperty(o,e,t)}},C4MV:function(o,e,t){o.exports={default:t("9bBU"),__esModule:!0}},bOdI:function(o,e,t){"use strict";e.__esModule=!0;var s,i=t("C4MV"),r=(s=i)&&s.__esModule?s:{default:s};e.default=function(o,e,t){return e in o?(0,r.default)(o,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[e]=t,o}},hOuv:function(o,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=t("bOdI"),i=t.n(s),r=t("Gu7T"),n=t.n(r),a=t("woOf"),d=t.n(a),c=t("//Fk"),h=t.n(c),l=t("Xxa5"),p=t.n(l),u=t("mvHQ"),g=t.n(u),f=t("exGp"),v=t.n(f),m=t("GQaK"),y=(t("fxnj"),t("d1wj")),C=t("yt7g"),w=t("CyOZ"),T=t("zSeF"),S=t("OUXH"),_=t("rguH"),b=t("wzPG"),I=t("7AG+"),k=t("zZaa"),D={components:{NavHeader:S.a,SwiperComponent:_.a,LoadingPage:I.a,ModelWin:b.a,WaitingTip:k.a},data:function(){return{path:"",query:{},scroll:null,productDetail:{},freightRange:{},amount:1,goodsDetail:{},jsonPropLength:0,isShowDetail:!0,errorTip:"",showModel:!1,isConfirm:!1,okType:"",isLoadCompleted:!0,result:1,previewUrl:"",isPreview:!1,specObj:{},imgPath:"https://qdwzvue-1254182596.cos.ap-guangzhou.myqcloud.com/qdwzAct/pafeite/",goodsImgList:[],isSubmitShow:!1,userName:"",phoneno:"",idCard:"",verCode:"",countdown:!0,countdownTime:60,timer:null,freight:0,mallType:1,orderType:2,productList:[],goodsList:[],goodsType:4,isClicked:!1,mask:!1}},mounted:function(){var o=this;$("body").show(),this.$nextTick(v()(p.a.mark(function e(){var t;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Object(w.a)(o,o.getHeaders,"-1"),t={},o.path=window.location.href,o.$route.query.goodsId?(o.query.goodsId=o.$route.query.goodsId,t.goodsId=o.query.goodsId,window.sessionStorage.setItem("goodsInfor",g()(t))):(o.query.goodsId=JSON.parse(window.sessionStorage.getItem("headerInfor")).goodsId,JSON.parse(window.sessionStorage.getItem("goodsInfor")).goodsId?o.query.goodsId=JSON.parse(window.sessionStorage.getItem("goodsInfor")).goodsId:o.query.goodsId=JSON.parse(window.sessionStorage.getItem("headerInfor")).goodsId),o.$route.query.redirectUrl&&(o.query.redirectUrl=o.$route.query.redirectUrl),o.query.goodsId&&(o.initGoodsDetail(),o.finish(),C.a.commonFunc(o));case 6:case"end":return e.stop()}},e,o)})))},updated:function(){this.finish()},computed:{getHeaders:function(){return this.$store.getters.getHeaders},containerId:function(){return this.$store.state.containerId},totalScore:function(){for(var o=0,e=0,t=this.productList.length;e<t;e++)o+=this.productList[e].amount*this.productList[e].goodsScore;return o},myScore:function(){return this.$store.state.balanceScore}},methods:i()({initScroll:function(){this.scroll=new m.a(this.$refs.scrollWrapper,{scrollbar:{fade:!0},click:!0})},initGoodsDetail:function(){var o=this;return new h.a(function(e,t){o.$http.get(y.a.product.goodsDetail,{params:{goodsId:o.query.goodsId}}).then(function(t){var s=t.data;if(s.code===T.a.SUCCESS){o.goodsDetail=s.data,o.goodsImgList=s.data.goodsImgs;var i=JSON.parse(o.goodsDetail.jsonProp);delete o.goodsDetail.jsonProp,o.goodsDetail.jsonProp=i,o.jsonPropLength=o.goodsDetail.jsonProp.length;var r=o.goodsDetail.chooseJsonProp;if(delete o.goodsDetail.chooseJsonProp,o.goodsDetail.chooseJsonProp=r,o.goodsDetail=d()({},o.goodsDetail||{}),null!=o.goodsDetail.chooseJsonProp){for(var n in o.goodsDetail.chooseJsonProp)o.specObj[n]=o.goodsDetail.chooseJsonProp[n][0];o.query.chooseJsonProp=g()(o.specObj)}o.productList=[{goodsId:o.query.goodsId,goodsScore:o.goodsDetail.goodsScore,goodsName:o.goodsDetail.goodsName,amount:o.amount}],o.goodsList=[{goodsId:o.query.goodsId,amount:o.amount,chooseJsonProp:o.query.chooseJsonProp,goodsScore:o.goodsDetail.goodsScore,goodsType:o.goodsType,userName:"",mobile:"",idCard:""}]}else C.a.checkStatus(o,s,{page:"productDetail"},o.initGoodsDetail);o.$nextTick(function(){o.finish(),o.loadImage()}),e()})})},edit:function(o){"add"===o?(this.amount++,this.amount>this.goodsDetail.goodsStock&&(this.amount=this.goodsDetail.goodsStock,this.errorTip="数量已超过该最大的库存",this.showModel=!0,this.isConfirm=!1)):"reduce"===o&&this.amount>1&&this.amount--},showDetail:function(){this.isShowDetail=!this.isShowDetail},finish:function(){this.scroll?(this.scroll.refresh(),this.scroll.finishPullUp()):this.initScroll()},closeModelWin:function(){this.showModel=!1,this.isConfirm=!1},okModelWin:function(o){o()},preview:function(o){""!=o&&(this.previewUrl=o,this.isPreview=!0)},closePreview:function(){this.isPreview=!1},specAction:function(o,e){for(var t in this.specObj)if(o==t){this.specObj[t]=e,this.$forceUpdate(),this.$set(this.specObj,t,e),this.query.chooseJsonProp=g()(this.specObj);break}},nowBuy:function(){this.myScore>=this.goodsDetail.goodsScore?(this.query.amount=this.amount,this.$router.push({path:"/createOrder",query:this.query})):this.mask=!0},scancode:function(){this.$router.push({path:"/scancode"})},closemask:function(){this.mask=!1},loadImage:function(){var o=this;return v()(p.a.mark(function e(){var t,s,i,r,a,d,c,h;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=o.goodsDetail.goodsImgs,s=[],i=o.$refs.detailContent.getElementsByTagName("img"),s=[].concat(n()(t)),r=0,a=i.length;r<a;r++)s.push({picUrl:i[r].src});d=p.a.mark(function e(t,i){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.loadImage(s[t].picUrl).then(function(){t===i-1&&(o.finish(),o.isLoadCompleted=!0)});case 2:case"end":return e.stop()}},e,o)}),c=0,h=s.length;case 7:if(!(c<h)){e.next=12;break}return e.delegateYield(d(c,h),"t0",9);case 9:c++,e.next=7;break;case 12:case"end":return e.stop()}},e,o)}))()},cancelSubmit:function(){this.isSubmitShow=!1},confirmSubmit:function(){2!=this.goodsDetail.goodsType&&(7==this.goodsDetail.goodsType?(this.isClicked=!0,this.redeemRecharge()):4==this.goodsDetail.goodsType?this.redeemCoupon():8==this.goodsDetail.goodsType&&this.redeemTickets())},redeemRecharge:function(){return/^1[0-9]{10}$/.test(this.phoneno)?""==this.verCode?(this.errorTip="验证码不能为空",this.showModel=!0,this.isConfirm=!1,!1):(this.goodsType=7,this.goodsList[0].mobile=this.phoneno,void(this.goodsList[0].goodsType=this.goodsType)):(this.errorTip="手机号码格式不正确",this.showModel=!0,this.isConfirm=!1,!1)},ReceiveRechCard:function(o){var e=this;this.isClicked=!0,this.$http.post(y.a.order.shopReceiveRechCard,{lotteryId:o,phoneno:this.phoneno,verCode:this.verCode},{headers:this.getHeaders}).then(function(o){e.isClicked=!1;var t=o.data;if(t.code===T.a.SUCCESS){var s={goodsName:e.productList[0].goodsName,goodsType:e.goodsType,phoneno:e.phoneno};e.$router.push({path:"/exchangeSuccess",query:s})}else e.errorTip=t.msg,e.isConfirm=!1,e.showModel=!0})},exchangePublic:function(){var o=this,e={freight:this.freight,goodsList:this.goodsList,goodsTotal:1,mallType:this.mallType,orderType:this.orderType,receiveAddrId:"",orderCategory:0,payType:5,exchangeMoney:0,payScore:this.totalScore,payMoney:0,totalMoney:0,orderRemark:"",isContainer:0};this.isClicked=!0,this.$http.post(y.a.order.createOrder,e,{headers:this.getHeaders}).then(function(e){o.isClicked=!1;var t=e.data;t.code===T.a.SUCCESS?0===t.data.isPayFlag&&(7==o.goodsType?o.ReceiveRechCard(t.data.orderId):5==o.goodsType?o.$router.push({path:"/exchangeSuccess",query:{goodsName:o.productList[0].goodsName,goodsType:o.goodsType,sysActivityId:t.data.sysActivityId}}):4==o.goodsType?o.shopAcceptOriginCoupon(t.data.orderId):8==o.goodsType&&o.$router.push({path:"/exchangeSuccess",query:{goodsName:o.productList[0].goodsName,goodsType:o.goodsType,orderId:t.data.orderId}})):(o.errorTip=t.msg,o.showModel=!0,o.isConfirm=!1)})},redeemCoupon:function(){if(1==this.goodsDetail.receiveWay){if(""==this.phoneno)return this.errorTip="QQ号不能为空",this.showModel=!0,this.isConfirm=!1,!1}else{if(!/^1[0-9]{10}$/.test(this.phoneno))return this.errorTip="手机号码格式不正确",this.showModel=!0,this.isConfirm=!1,!1;if(""==this.verCode)return this.errorTip="验证码不能为空",this.showModel=!0,this.isConfirm=!1,!1}this.goodsType=4,this.goodsList[0].mobile=this.phoneno,this.goodsList[0].goodsType=this.goodsType,this.exchangePublic()},shopAcceptOriginCoupon:function(o){var e=this;this.isClicked=!0,this.$http.post(y.a.order.shopAcceptOriginCoupon,{lotteryId:o,phoneno:this.phoneno,verCode:this.verCode,receiveWay:this.goodsDetail.receiveWay},{headers:this.getHeaders}).then(function(o){e.isClicked=!1;var t=o.data;if(t.code===T.a.SUCCESS){var s={goodsName:e.productList[0].goodsName,goodsType:e.goodsType,phoneno:e.phoneno,receiveWay:e.goodsDetail.receiveWay};e.$router.push({path:"/exchangeSuccess",query:s})}else e.errorTip=t.msg,e.isConfirm=!1,e.showModel=!0})},redeemTickets:function(){return""==this.userName?(this.errorTip="姓名不能为空",this.showModel=!0,this.isConfirm=!1,!1):/^1[0-9]{10}$/.test(this.phoneno)?""==this.idCard?(this.errorTip="身份证号码不能为空",this.showModel=!0,this.isConfirm=!1,!1):(this.goodsType=8,this.goodsList[0].userName=this.userName,this.goodsList[0].mobile=this.phoneno,this.goodsList[0].idCard=this.idCard,this.goodsList[0].goodsType=this.goodsType,this.isClicked=!0,void this.exchangePublic()):(this.errorTip="手机号码格式不正确",this.showModel=!0,this.isConfirm=!1,!1)},getCode:function(){if(!/^1[0-9]{10}$/.test(this.phoneno))return this.errorTip="手机号码格式不正确",this.showModel=!0,this.isConfirm=!1,!1;this.countdown=!1;var o=this;this.timer=setInterval(function(){o.countdownTime--,0==o.countdownTime&&(clearInterval(this.timer),o.countdown=!0,o.countdownTime=60)},1e3),this.$http.get(y.a.order.getVerCode,{params:{mobile:this.phoneno}},{headers:this.getHeaders}).then(function(o){})}},"specAction",function(o,e){for(var t in this.specObj)if(o==t){this.specObj[t]=e,this.$forceUpdate(),this.$set(this.specObj,t,e),this.query.chooseJsonProp=g()(this.specObj);break}})},P={render:function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("div",[t("nav-header",{attrs:{back:"true",color:"1"}},[t("div",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[o._v("兑换商品")])]),o._v(" "),t("div",{ref:"scrollWrapper",staticClass:"scroll-wrapper"},[t("div",{staticClass:"wrapper"},[t("swiper-component",{attrs:{imgList:o.goodsImgList,swiperType:"proDefault"},on:{finishEvent:o.finish,previewEvent:o.preview}}),o._v(" "),t("div",{staticClass:"pro-box"},[t("div",{staticClass:"pro-title"},[o._v(o._s(o.goodsDetail.goodsName))]),o._v(" "),t("div",{staticClass:"pro-bottom"},[t("div",{staticClass:"price"},[t("span",{staticClass:"span1"},[o._v(o._s(o.goodsDetail.goodsScore)+"积分")]),o._v(" "),t("span",{staticClass:"span2"},[o._v("市场价值"+o._s(o.goodsDetail.goodsSalePrice)+"元")])])]),o._v(" "),t("div",{staticClass:"stock"},[o._v("\n\t\t\t\t\t库存\n\t\t\t\t\t"),t("span",[o._v(o._s(o.goodsDetail.goodsStock))])])]),o._v(" "),t("div",{staticClass:"detail-list"},[t("div",{staticClass:"detail-content"},[t("span",{ref:"detailContent",domProps:{innerHTML:o._s(o.goodsDetail.goodsDesc)}})])])],1)]),o._v(" "),t("div",{staticClass:"footer"},[t("div",{staticClass:"foot-left"},[t("div",{staticClass:"total"},[o._v("\n\t\t\t\t需要支付\n\t\t\t\t"),t("span",[o._v(o._s(o.goodsDetail.goodsScore)+"积分")])]),o._v(" "),t("div",{staticClass:"remain"},[o._v("\n\t\t\t\t当前积分：\n\t\t\t\t"),t("span",[o._v(o._s(o.myScore)+"积分")])])]),o._v(" "),t("div",{staticClass:"score-controls",on:{click:o.nowBuy}},[o._v("立即兑换")])]),o._v(" "),t("model-win",{attrs:{show:o.showModel}},[t("template",{slot:"content"},[o._v(o._s(o.errorTip))]),o._v(" "),t("template",{slot:"btn"},[o.isConfirm?[t("a",{staticClass:"btn",attrs:{href:"javascript:void(0);"},on:{click:o.closeModelWin}},[o._v(o._s(o.cancelBtnText))]),o._v(" "),t("a",{staticClass:"btn btn-last",attrs:{href:"javascript:void(0);"},on:{click:function(e){o.okModelWin(o.okType)}}},[o._v(o._s(o.okBtnText))])]:[t("a",{staticClass:"btn",attrs:{href:"javascript:void(0);"},on:{click:o.closeModelWin}},[o._v("确定")])]],2)],2),o._v(" "),t("transition",{attrs:{name:"fade"}},[o.isLoadCompleted?o._e():t("loading-page",{attrs:{page:"productDetail"}})],1),o._v(" "),t("transition",{attrs:{name:"fade"}},[t("waiting-tip",{directives:[{name:"show",rawName:"v-show",value:o.isClicked,expression:"isClicked"}]})],1),o._v(" "),o.mask?t("div",{staticClass:"tip-win"},[t("div",{staticClass:"tip-content"},[t("div",{staticClass:"tip-title"},[o._v("温馨提示")]),o._v(" "),t("div",{staticClass:"tip-dec"},[o._v("您当前的积分不足，去防伪扫码领积分？")]),o._v(" "),t("div",{staticClass:"tip-btn"},[t("div",{staticClass:"tip-cancel",on:{click:o.closemask}},[o._v("取消")]),o._v(" "),t("div",{staticClass:"tip-confirm",on:{click:o.scancode}},[o._v("确认")])])])]):o._e()],1)},staticRenderFns:[]};var M=t("VU/8")(D,P,!1,function(o){t("x0Wa"),t("myRq")},"data-v-9c10fbc0",null);e.default=M.exports},mClu:function(o,e,t){var s=t("kM2E");s(s.S+s.F*!t("+E39"),"Object",{defineProperty:t("evD5").f})},myRq:function(o,e){},x0Wa:function(o,e){}});