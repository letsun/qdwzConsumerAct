<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=750, user-scalable=no">
	<title>苏米诺SUMINO防伪查询</title>
	<link rel="stylesheet" type="text/css" href="/pafeite/css/index.css" />
</head>

<body>

	<!--加载页-->
	<div class="loading">
		<div class="loadCon">
			<img src="/pafeite/images/loading.png">
			<div id="percent">1%</div>
		</div>
	</div>

	<div class="container">

		<div class="contenta">
			<div class="scancode">
				<img src="https://qdwzvue-1254182596.cos.ap-guangzhou.myqcloud.com/qdwzAct/pafeite/1_1.png">
			</div>

			<div class="text">
				<div class="">点击上面扫一扫</div>
				<div>立即识别真伪 积分轻松享</div>
				<div>或手动输入防伪码(区分大小写)</div>
			</div>

			<div class="inp">
				<input type="text" placeholder="撕开罐底二维码涂层输入防伪码">
			</div>

			<div class="btn1" id="">
				<img src="https://qdwzvue-1254182596.cos.ap-guangzhou.myqcloud.com/qdwzAct/pafeite/1_2.png" alt=""
					srcset="">
			</div>

		</div>



		<!-- 验证结果 -->

		<div class="contentb">
			<div class="phoneimg1"> <img
					src="https://qdwzvue-1254182596.cos.ap-guangzhou.myqcloud.com/qdwzAct/pafeite/2_3.png"></div>
			<div class="phoneimg2"> <img
					src="https://qdwzvue-1254182596.cos.ap-guangzhou.myqcloud.com/qdwzAct/pafeite/2_4.png"></div>

			<div class="phoneimg3"> <img
					src="https://qdwzvue-1254182596.cos.ap-guangzhou.myqcloud.com/qdwzAct/pafeite/2_5.png"></div>

			<div class="integral">
				<img src="https://qdwzvue-1254182596.cos.ap-guangzhou.myqcloud.com/qdwzAct/pafeite/2_2.png">
				<div class="integral-num"></div>
			</div>

			<div class="text1">
				<div>你好</div>
				<div>这是该产品的第<span class="num">1</span>次验证</div>
				<div>您所查询的产品为正品</div>
				<div>产自于新西兰GMP乳业，请放心使用!</div>
				<div class="btn">
					<img src="https://qdwzvue-1254182596.cos.ap-guangzhou.myqcloud.com/qdwzAct/pafeite/2_1.png">
				</div>
			</div>

			<div class="text2">
				<div>你好</div>
				<div>这是该产品的第<span class="num">2</span>次验证,</div>
				<div>首次验证时间为<span class="tiemr">2020.3.12 16:20</span>, </div>
				<div>该产品为正品,</div>
				<div>产自于新西兰GMP乳业，请放心使用!</div>

				<div class="btn">
					<img src="https://qdwzvue-1254182596.cos.ap-guangzhou.myqcloud.com/qdwzAct/pafeite/2_1.png">
				</div>
			</div>

			<div class="text3">
				<div>你好</div>
				<div>您的验证码已被查询<span class="num">2</span>次以上</div>
				<div>首次验证时间为<span class="tiemr">2020.3.12 16:20</span></div>
				<div>如有疑问可联系我们：400-885-6695</div>

				<div class="btn">
					<img src="https://qdwzvue-1254182596.cos.ap-guangzhou.myqcloud.com/qdwzAct/pafeite/2_1.png">
				</div>
			</div>

		</div>
		<div class="mask">
			<div class="mask-popup">
				<div class="mask-title">
					温馨提示
				</div>

				<div class="mask-img">
					<img src="https://qdwzvue-1254182596.cos.ap-guangzhou.myqcloud.com/qdwzAct/pafeite/2_7.png">
				</div>

				<div class="mask-text">
					长按识别关注公众号 进入积分商城
				</div>

				<div class="mask-btn">
					<img src="https://qdwzvue-1254182596.cos.ap-guangzhou.myqcloud.com/qdwzAct/pafeite/2_8.png">
				</div>
			</div>
		</div>
	</div>




</body>

<!-- 公共js start -->
<%-include("../../include/commonJs") %>
<%-include("../../include/hideMenu") %>

<!-- 页面js end -->
<script src="/yifeinewmuban/scripts/lib/jweixin-1.0.0.js"></script>
<script src="/pafeite/js/api.js"></script>
<script src="/pafeite/js/Func.js"></script>

<script>
	// 签名处理
	var encode = Global.getUrlParam('encode');


	if (encode != undefined) {
		var encode = Global.getUrlParam('encode');
		window.sessionStorage.setItem('encode', encode)
	}

	getHeader();
	var href = window.location.href.split('?');
	if (window.sessionStorage.headerInfor) {
		if (href[1]) {
			window.location.href = href[0];
		}

	}

	$(function () {

		encode = window.sessionStorage.getItem('encode');
		if (encode) {
			$('.contentb').show();
			createJoinActInfo()//查找活动参与记录
			findRealEncodeFunction()// 查询防伪信息
		} else {

			$('.contenta').show();
			$.ajax({
				url: api.jssdk,
				type: 'GET',
				dataType: 'json',
				headers: getHeader(),
				data: {
					thisurl: window.location.href.split('?')[0]
				},
				success: function (res) {
					$('#loadingWrapper').hide();
					if (res.code == '00') {
						wx.config({
							debug: false,// 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
							appId: res.autAppid,// 必填，公众号的唯一标识
							timestamp: res.timestamp,// 必填，生成签名的时间戳
							nonceStr: res.nonceStr,// 必填，生成签名的随机串
							signature: res.signature,
							jsApiList: [
								'hideMenuItems',
								'hideAllNonBaseMenuItem',
								'hideOptionMenu',
								'scanQRCode',
							]
						});

						wx.ready(function () { });

					}

				}
			});
		}




		//点击扫码
		$('.scancode').on('click', function () {
			wx.scanQRCode({
				needResult: 0, // 默认为0，扫描结果由微信处理，1则直接返回扫描结果，
				scanType: ["qrCode"], // 可以指定扫二维码还是一维码，默认二者都有
				success: function (res) {

					//var result = res.resultStr; // 当needResult 为 1 时，扫码返回的结果
					var encode = res.resultStr.split('/');
					var code = encode[encode.length - 1];

				}
			});
		})

		//点击防伪查找二维码情况
		$('.btn1').on('click', function () {
			var inpval = $('input').val();
			Func.findEncode({
				antifakeCode: inpval
			}, function (res) {
				if (res.code == 200) {
					$('.contentb').show();
					$('.contenta').hide();
					var antifakeEncode = res.data.antifakeEncode;

					createJoinActInfo()//查找活动参与记录
					findRealEncodeFunction()// 查询防伪信息
				} else {
					common.alert({
						mask: true,
						content: res.msg
					})
				}

			})
		})



		// 点击公众号弹窗我知道了
		$('.mask-btn').on('click', function () {
			$('.mask').fadeOut()
		})


		//是否关注公众号
		$('.btn').on('click', function () {
			Func.isSubscribe(function (res) {
				if (res.code == 200) {
					if (!res.data.subscribe) {
						$('.mask').show()
					} else {
						window.location.href = api.ip + `/shop/index/1/` + getHeader().cpi + `?csi=` + getHeader().csi + `&oi=` + getHeader().oi
					}
				} else {
					common.alert({
						content: res1.msg,
						mask: true
					});
				}

			})

		})


		function createJoinActInfo() {
			Func.createJoinActInfo(function (res) {
				if (res.code == 200) {
					lottery()
				} else if (res.code == 201) {
					// $('.tip').text('该积分已被领取').show();
				} else if (res.code == 202) {
					// //0未领奖 1已领奖 2领取失败	
					// if (res.data.status == 0) {
					// 	var point = res.data.prizeAmount;
					// 	$('#point').text(point);
					// 	$('.tip').show();
					// } else if (res.data.status == 1) {
					// 	$('.tip').text('该积分已被领取').show();
					// }
				} else if (res.code == 203) {
					// $('.tip').text('该积分已被领取').show();
				} else {
					common.alert({
						mask: true,
						content: res.msg
					})
				}
			})
		}



		//抽奖
		function lottery() {
			Func.lottery(function (reg) {
				if (reg.code == 200) {
					var point = reg.data.point.point;
					$('.integral-num').text(point);
				}
			})
		}


		// 查询防伪信息
		function findRealEncodeFunction() {
			Func.findRealEncodeFunction(function (res) {
				if (res.code == 200) {
					var valiCount = res.data.securityCheckRecord.valiCount;
					var firstValiTime = formatDateTime(res.data.securityCheckRecord.firstValiTime)
					if (valiCount == 1) {
						$('.phoneimg1').show();
						$('.text1').show();
						$('.integral').show();
						$('.num').html(valiCount);
					} else if (valiCount == 2) {
						$('.phoneimg2').show();
						$('.text2').show();
					} else {
						$('.phoneimg3').show();
						$('.text3').show();
					}

					$('.tiemr').text(firstValiTime)
				} else {
					common.alert({
						mask: true,
						content: res.msg
					})
				}
			});
		}


		/**
		 * 时间戳转日期
		 * 
		 * @param {*} timestamp 要转换的时间戳参数
		 */
		function formatDateTime(timestamp) {
			var date = new Date(timestamp)
			//var date = new Date(timestamp * 1000);//时间戳为10位需*1000，时间戳为13位的话不需乘1000
			var Y = date.getFullYear() + `-`;
			var M = (date.getMonth() + 1 < 10 ? `0` + (date.getMonth() + 1) : date.getMonth() + 1) + `-`;
			var D = (date.getDate() < 10 ? `0` + (date.getDate()) : date.getDate()) + ` `;
			var h = (date.getHours() < 10 ? `0` + (date.getHours()) : date.getHours()) + `:`;
			var m = (date.getMinutes() < 10 ? `0` + (date.getMinutes()) : date.getMinutes()) + `:`;
			var s = (date.getSeconds() < 10 ? `0` + (date.getSeconds()) : date.getSeconds());
			// var s = date.getSeconds();
			return Y + M + D + h + m + s;
		};


		// 输入框失去焦点兼容苹果系统
		$('.container').on('blur', 'input,textarea,select', function () {
			setTimeout(function () {
				var hasFocus = $('input').is(':focus') || $('textarea').is(':focus') || $('select').is(':focus');
				if (!hasFocus) {
					window.scroll(0, 0);
				}
			}, 100);
		});
	})

</script>


</html>